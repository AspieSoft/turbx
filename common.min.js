const crypto=require("crypto"),validator=require("validator");function varType(e){return Array.isArray(e)?"array":null===e?"null":e instanceof RegExp?"regex":typeof e}function toNumber(e){return"number"==typeof e?e:Number(e.replace(/[^0-9.]/g,"").split(".",2).join("."))}module.exports={escapeHTML:function(e){return e.replace(/[<>&]/g,(e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return""}})).replace(/&amp;(amp;)*/g,"&amp;")},escapeHTMLArgs:function(e){return e.replace(/([\\"'`])/g,"\\$1")},compileMD:function(e){return e},compileJS:function(e){return e},compileCSS:function(e){return e},sleep:e=>new Promise((t=>setTimeout(t,e))),randomToken:function(e){return crypto.randomBytes(e).toString("hex")},clean:function(e,t=!1){let r=[338,339,352,353,376,402,8211,8212,8216,8217,8218,8220,8221,8222,8224,8225,8226,8230,8240,8364,8482];function n(e){if(e=validator.stripLow(e,{keep_new_lines:!0}),validator.isAscii(e))return e;let n="";for(let i=0;i<e.length;i++){let u=e.charCodeAt(i);(t&&u>=0&&u<=31||u>=32&&u<=127||u>=160&&u<=255||r.includes(u))&&(n+=e.charAt(i))}return validator.isAscii(n)?n:void 0}return function e(t){if(null===t)return null;if(void 0!==t){if(NaN===t)return NaN;switch(varType(t)){case"string":return n(t);case"array":return function(t){let r=[];return t.forEach((t=>{r.push(e(t))})),r}(t);case"object":return function(t){let r={};return Object.keys(t).forEach((n=>{n=e(n),r[n]=e(t[n])})),r}(t);case"number":return Number(t);case"boolean":return!!t;case"regex":let r="",i=t.toString().replace(/^\/(.*)\/(\w*)$/,(function(e,t,i){return r=n(i)||"",n(t)||""}));if(!i||""===i)return;return RegExp(i,r);case"symbol":return void 0!==(t=n(t.toString()))?Symbol(t):void 0;case"bigint":return BigInt(t.toString().replace(/[^0-9\.\-\+enf_]/g,""));default:return}}}(e)},varType,toTimeMillis:function(e){return"number"==typeof e?Number(e):e&&"string"==typeof e&&""!==e.trim()?e.endsWith("h")?36e5*toNumber(e):e.endsWith("m")?6e4*toNumber(e):e.endsWith("s")?1e3*toNumber(e):e.endsWith("D")?864e5*toNumber(e):e.endsWith("M")?2628e6*toNumber(e):e.endsWith("Y")?31536e6*toNumber(e):e.endsWith("DE")?31536e7*toNumber(e):e.endsWith("C")||this.endsWith("CE")?31536e8*toNumber(e):e.endsWith("ms")?toNumber(e):e.endsWith("us")||this.endsWith("mic")?.001*toNumber(e):e.endsWith("ns")?1e-6*toNumber(e):toNumber(e):NaN},toNumber,asyncReplace:async function(e,t,r,global){if(void 0===global&&(global=!!t.toString().match(/\/[\w]*g[\w]*$/)),!global){const n=e.match(t);return n?e.substring(0,n.index)+await r(...n,n.index)+e.substring(n.index+n[0].length):e}const n=[...e.matchAll(t)];if(n&&n.length){const t=[];for(let e=0;e<n.length;e++)t.push({start:n[e].index,end:n[e].index+n[e][0].length,res:await r(...n[e],n[e].index)});for(let r=t.length-1;r>=0;r--)e=e.substring(0,t[r].start)+t[r].res+e.substring(t[r].end)}return e},getOpt:function(e,t,r=!0){if(["number","boolean"].includes(typeof t)&&(t=t.toString()),"string"!=typeof t||"object"!=typeof e)return"";t=t.split("|");for(let n=0;n<t.length;n++){let i=t[n].split(".").reduce(((e,t)=>"object"!=typeof e||e instanceof RegExp?e:(t.match(/^\[.*?\]$/)&&(t=(t=t.replace(/^\[(.*)\]$/,"$1")).match(/^(['"`])(.*)\1$/)?t.replace(/^(['"`])(.*)\1$/,"$1"):e[t]),e[t])),e);if(!r){if(null==i){if(n===t.length-1)return i;continue}return i}if(null!=i&&"object"!=typeof i)return i.toString()}return""}};